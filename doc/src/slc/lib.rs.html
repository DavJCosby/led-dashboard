<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `src\lib.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>lib.rs - source</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../slc/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input"name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">  1</span>
<span id="2">  2</span>
<span id="3">  3</span>
<span id="4">  4</span>
<span id="5">  5</span>
<span id="6">  6</span>
<span id="7">  7</span>
<span id="8">  8</span>
<span id="9">  9</span>
<span id="10"> 10</span>
<span id="11"> 11</span>
<span id="12"> 12</span>
<span id="13"> 13</span>
<span id="14"> 14</span>
<span id="15"> 15</span>
<span id="16"> 16</span>
<span id="17"> 17</span>
<span id="18"> 18</span>
<span id="19"> 19</span>
<span id="20"> 20</span>
<span id="21"> 21</span>
<span id="22"> 22</span>
<span id="23"> 23</span>
<span id="24"> 24</span>
<span id="25"> 25</span>
<span id="26"> 26</span>
<span id="27"> 27</span>
<span id="28"> 28</span>
<span id="29"> 29</span>
<span id="30"> 30</span>
<span id="31"> 31</span>
<span id="32"> 32</span>
<span id="33"> 33</span>
<span id="34"> 34</span>
<span id="35"> 35</span>
<span id="36"> 36</span>
<span id="37"> 37</span>
<span id="38"> 38</span>
<span id="39"> 39</span>
<span id="40"> 40</span>
<span id="41"> 41</span>
<span id="42"> 42</span>
<span id="43"> 43</span>
<span id="44"> 44</span>
<span id="45"> 45</span>
<span id="46"> 46</span>
<span id="47"> 47</span>
<span id="48"> 48</span>
<span id="49"> 49</span>
<span id="50"> 50</span>
<span id="51"> 51</span>
<span id="52"> 52</span>
<span id="53"> 53</span>
<span id="54"> 54</span>
<span id="55"> 55</span>
<span id="56"> 56</span>
<span id="57"> 57</span>
<span id="58"> 58</span>
<span id="59"> 59</span>
<span id="60"> 60</span>
<span id="61"> 61</span>
<span id="62"> 62</span>
<span id="63"> 63</span>
<span id="64"> 64</span>
<span id="65"> 65</span>
<span id="66"> 66</span>
<span id="67"> 67</span>
<span id="68"> 68</span>
<span id="69"> 69</span>
<span id="70"> 70</span>
<span id="71"> 71</span>
<span id="72"> 72</span>
<span id="73"> 73</span>
<span id="74"> 74</span>
<span id="75"> 75</span>
<span id="76"> 76</span>
<span id="77"> 77</span>
<span id="78"> 78</span>
<span id="79"> 79</span>
<span id="80"> 80</span>
<span id="81"> 81</span>
<span id="82"> 82</span>
<span id="83"> 83</span>
<span id="84"> 84</span>
<span id="85"> 85</span>
<span id="86"> 86</span>
<span id="87"> 87</span>
<span id="88"> 88</span>
<span id="89"> 89</span>
<span id="90"> 90</span>
<span id="91"> 91</span>
<span id="92"> 92</span>
<span id="93"> 93</span>
<span id="94"> 94</span>
<span id="95"> 95</span>
<span id="96"> 96</span>
<span id="97"> 97</span>
<span id="98"> 98</span>
<span id="99"> 99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
</pre><pre class="rust">
<span class="doccomment">//! # SLC - Spatial Lighting Controller</span>
<span class="doccomment">//! ```toml</span>
<span class="doccomment">//! slc = { git = &quot;https://github.com/DavidCosbyUofU/slc&quot; }</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Spatial Lighting Controller is a project I&#39;ve started to give myself advanced control over the</span>
<span class="doccomment">//! individually-addressable LED strip lights in my room. What separates SLC (pronounced silk) from other LED controllers</span>
<span class="doccomment">//! is that it allows you to map out the user&#39;s room in 2D space, imagine a camera within that room, and light up LEDs using that camera&#39;s coordinate space.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! use slc::prelude::*;</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! let room = Room::new(&quot;path/to/config.rcfg&quot;);</span>
<span class="doccomment">//! room.set_input_device(CustomInput);</span>
<span class="doccomment">//! room.add_output_device(CustomOutput);</span>
<span class="doccomment">//! room.start();</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! struct CustomInput;</span>
<span class="doccomment">//! struct CustomOutput;</span>

<span class="doccomment">//! impl InputDevice for CustomInput {</span>
<span class="doccomment">//!     fn start(&amp;self, input_handle: RoomControllerInputHandle) {</span>
<span class="doccomment">//!         let mut room_controller = input_handle.write().unwrap();</span>
<span class="doccomment">//!         // set all pixels white</span>
<span class="doccomment">//!         room_controller.set_all((255, 255, 255));</span>
<span class="doccomment">//!         // set the LED leftmost to the camera red</span>
<span class="doccomment">//!         controller_write.set_at_view_angle(PI, (255, 0, 0));</span>
<span class="doccomment">//!         // set the LED rightmost to the camera green</span>
<span class="doccomment">//!         controller_write.set_at_view_dir((1.0, 0.0), (0, 255, 0));</span>
<span class="doccomment">//!         // set the northmost LED blue (relative to the room&#39;s coordinate space)</span>
<span class="doccomment">//!         room_controller.set_at_room_dir((0.0, 1.0), (0, 0, 255));</span>
<span class="doccomment">//!     }</span>
<span class="doccomment">//!</span>
<span class="doccomment">//!     fn stop(&amp;mut self) {}</span>
<span class="doccomment">//! }</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! impl OutputDevice for CustomOutput {</span>
<span class="doccomment">//!     fn start(&amp;self, output_handle: RoomControllerOutputHandle) {</span>
<span class="doccomment">//!         let room_controller = output_handle.read().unwrap();</span>
<span class="doccomment">//!</span>
<span class="doccomment">//!         for led in room_controller.room_data.leds() {</span>
<span class="doccomment">//!             println!(&quot;{:?}&quot;, led);</span>
<span class="doccomment">//!         }</span>
<span class="doccomment">//!     }</span>
<span class="doccomment">//! }</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! #</span>
<span class="doccomment">//! ## *Disclaimer*</span>
<span class="doccomment">//! The SLC crate is not in charge of interfacing with GPIO pins or activating any real-world LEDs; you will need to write your own OutputDevice to handle that. SLC is merely a set of tools that lets you think of your LEDs in spatial terms. </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! In my setup, my PC does all the calculations for InputDevices and then streams the LEDS over to my Raspberry Pi via a TCP OutputDevice. The Pi listens to that TCP connection via an InputDevice, and then displays them on the real LEDs via a GPIO OutputDevice. See [this repository](https://github.com/DavidCosbyUofU/slc_tcp) for more information. </span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## IO</span>
<span class="doccomment">//! Input and Output Devices should implement the traits [InputDevice and OutputDevice](devices), respectively. Since we have created thread-safe input and output handles in the example above, you are encouraged to run continuous code in the `.start()` methods on a separate thread.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! OutputDevices should only access the RoomController in read-only fashion. The RoomControllerOutputHandle passed in through the start method is actually just a RwLock around a RoomController, which helps us keep our mutability straight.</span>
<span class="doccomment">//! ### `MyInputDevice.start()`</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! // --snip--</span>
<span class="doccomment">//! let mut controller_write_access = input_handle.write().unwrap();</span>
<span class="doccomment">//! println!(&quot;Our LED strips have a density of {} LEDs/meter.&quot;, controller_write_access.room_data.density); // also okay</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! controller_write_access.set(0, (0, 255, 0)); // okay</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ### `MyOutputDevice.start()`</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! // --snip--</span>
<span class="doccomment">//! let mut controller_read_access = input_handle.read().unwrap();</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! println!(&quot;Color of the 1st LED: {:?}&quot;, controller_read_access.room_data.leds()[1]); // okay</span>
<span class="doccomment">//! controller_read_access.set(0, (0, 255, 0)); // illegal, will not compile</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! InputDevices are required to inplement a `.stop()` method, while OutputDevices do not. This is because you likely will want to swap out visual effects at run-time, but you are unlikely to need to swap out display methods on-the-go.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Room, RoomController, and RoomData</span>
<span class="doccomment">//! Constructing a Room creates a RoomData struct behind the scenes, which can be accessed via a RoomController. Rooms are created from a room configuration (.rcfg) file, which follows the format below:</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! 60                      // LED density (LEDs/meter)</span>
<span class="doccomment">//! 0.75 0.75               // Position (meters) of the &quot;Camera&quot;</span>
<span class="doccomment">//! 0                       // Rotational offset (degrees, counter-clockwise, auto converted into radians) of the &quot;Camera&quot; (0 = facing right, 90 = facing up)</span>
<span class="doccomment">//! 0 -1.5 2.0 0            // strip0_start.x strip0_start.y strip0_end.x strip0_end.y</span>
<span class="doccomment">//! 2.0 0 1.5 1.5           // strip1_start.x strip1_start.y strip1_end.x strip1_end.y</span>
<span class="doccomment">//! 1.5 1.5 1.5 2.0         // strip2_start.x strip2_start.y strip0_end.x strip2_end.y</span>
<span class="doccomment">//!                         // and so on...</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Running `Room::new(filepath)` will parse through this data to create RoomData. Using the density and strip coordinates provided, it calculates the number of LEDs in the room and uses that number to create a vector of (u8, u8, u8) tuples. Each tuple represents an LED&#39;s color in the room.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Rooms can be given an InputDevice and multiple OutputDevices via its `set_input_device()` and `add_output_device()` methods. Calling `.start()` on a Room will run the `.start()` method on each connected Input and Output devices. Each device receives either a RoomControllerInputHandle or a RoomControllerOutputHandle, a thread-safe wrapper equivalent to `Arc&lt;RwLock&lt;RoomController&gt;&gt;`.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ## Mapping</span>
<span class="doccomment">//! The &quot;set at view/direction&quot; methods showcased earlier are good for when you need a color at a precise</span>
<span class="doccomment">//! direction, but because they rely on a ray-line segment intersection algorithm to find the target led, they can be expensive. SLC offers an alternative approach to directional coloring, in the form of maps.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! // --snip--</span>
<span class="doccomment">//! let uv_map = |(dx, dy): (f32, f32)| {</span>
<span class="doccomment">//!     let r = ((dx + 1.0) * 0.5) * 255.0;</span>
<span class="doccomment">//!     let g = ((dy + 1.0) * 0.5) * 255.0;</span>
<span class="doccomment">//!     (r as u8, g as u8, 0)</span>
<span class="doccomment">//! };</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! room_controller.map_dir_to_color(&amp;uv_map);</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! If you only want to color the leds within a certain area, you can set a `min_angle` and a `max_angle`.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//! let map = |(dx, dy): (f32, f32)| { ... };</span>
<span class="doccomment">//! room_controller.map_dir_to_color_clamped(&amp;map, 0.0, PI / 4.0);</span>
<span class="doccomment">//! ```</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! See the [docs](http://davidcosbyuofu.github.io/doc/slc/room_controller) for a full list of mapping methods.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! # Examples</span>
<span class="doccomment">//! Below are some examples to get you started building your own input and output devices.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ### Input</span>
<span class="doccomment">//! * [Calibration](https://github.com/DavidCosbyUofU/slc_examples/tree/main/input_devices/calibration) - Paints the LEDs at each vertex yellow, and and sets the LEDs directly forward, left, right, and backwards white, red, green, and blue, respectively. Useful for calibrating your room the first time, when using real LEDs.</span>
<span class="doccomment">//! * [Sweep](https://github.com/DavidCosbyUofU/slc_examples/tree/main/input_devices/sweep) - A simple visual effect that sweeps a green light around the room, kinda like a radar.</span>
<span class="doccomment">//! * [Rainbow]([crates/slc_lab_rainbow](https://github.com/DavidCosbyUofU/slc_examples/tree/main/input_devices/lab_rainbow)) - Uses the mapping feature to map LED direction to their associated color on the CIELAB color wheel.</span>
<span class="doccomment">//! ### Output</span>
<span class="doccomment">//! * [TCPClient](https://github.com/DavidCosbyUofU/slc_examples/tree/main/output_devices/tcp_client) - Streams LEDs over a TCP connection, frame by frame. See the repository for more information.</span>
<span class="doccomment">//! * [Gui](https://github.com/DavidCosbyUofU/slc_examples/tree/main/output_devices/slc_gui) - 3D Gui powered by Bevy that lets you preview your room and visual effects. Very convenient if you don&#39;t have your LEDs set up yet.</span>
<span class="doccomment">//!</span>


<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">prelude</span>;
<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">room</span>;
<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">room_data</span>;
<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">room_controller</span>;
<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">devices</span>;
<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">util</span>;</pre></div>
</section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="slc" data-search-index-js="../../search-index.js" data-search-js="../../search.js"></div>
    <script src="../../main.js"></script><script src="../../source-script.js"></script><script src="../../source-files.js"></script>
</body></html>